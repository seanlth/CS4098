<!DOCTYPE html>
<html lang="en">


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.22/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.22/addons/p5.dom.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.22/addons/p5.sound.min.js"></script>
  <script src="{{url_for('static', filename='js/sketch.js')}}"></script>
  <script src="{{url_for('static', filename='js/pml_generator.js')}}"></script>
  <script src="{{url_for('static', filename='js/flowlines.js')}}"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='diagramEditor.css') }}">

  <body>
  <style type="text/css">
  .navbar{
    background:url("static/images/dark_wall.png");
  }
  </style>
  <nav class="navbar navbar-default" role="navigation">
      <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
      </div>
      <div class="navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
              <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">File </a>
                  <ul class="dropdown-menu">
                      <li><a href="javascript:new_hook()">New</a></li>
                      <!-- <li><a href="javascript:open_hook()">Open</a></li>
                      <li>
                        <form action="upload" method="post" enctype="multipart/form-data" id ="fileUpload">
                          {% if not 'email' in session %}
                            <a href="/login" style="color: #333333;">Upload</a>
                          {% else %}
                            <input id="upload-file" type="file" name="file" style="display: none;">
                            <script>
                              document.getElementById('upload-file').onchange = function() {
                                  document.getElementById("fileUpload").submit();
                              }

                            </script>
                            <a1 onclick="$('input[id=upload-file]').click();">Upload</a1>
                            <script>

                            // $('input').change(function(){
                            //    $(this).attr('title',($(this).val()));
                            // });
                            </script>
                          {% endif %}
                        </form>
                      </li>
                      <li><a href="javascript:save_hook()">Save</a></li>
                      <li><a href="javascript:saveAs_hook()">Save As</a></li> -->
                      <!-- <li class="divider"></li> -->
                      <!-- <li><a href="#">Separated link</a></li> -->
                  </ul>
              </li>
              <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Action Colour </a>
                  <ul class="dropdown-menu">
                      <li><a href="javascript:changeActionColour(ActionColourEnum.none)">None</a></li>
                      <li><a href="javascript:changeActionColour(ActionColourEnum.analysis)">Analysis</a></li>
                      <li><a href="javascript:changeActionColour(ActionColourEnum.agent)">Agent</a></li>
                  </ul>
              </li>
              <li>
                  <a href="javascript:run_hook()">Analyse </a>
              </li>

              <li>
                  <a href="javascript:parse_hook()">Generate PML </a>
              </li>
			  <li>
                  <a href="javascript:toggle_flowlines()">Toggle Flow Lines </a>
              </li>
              <li>
                  <a href="javascript:toggle_editing()">Toggle Editing </a>
              </li>

          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li>
              {% if not 'email' in session %}
              <a href="/login"><r>Login</r></a>
              {% else %}
              <a href="/logout"><r>Logout</r></a>
              {% endif %}
            </li>
          </ul>
      </div><!-- /.navbar-collapse -->
  </nav>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <form id="actionEditor" style="width: 300px;background-image:url('static/images/dark_wall.png'); color:#fff;">
    <table>
      <p>Name: <Input type="text" name="name" id="name"/></p>
      <p> Type:
        <select id="type" name="type" style="color:#000">
          <option value="none">None</option>
          <option value="manual">Manual</option>
          <option value="executable">Executable</option>
        </select>
      </p>
      <br>
      <p> Agent:
        <input type="text" id="agent" name="agent"/>
      </p>
      <p> Script: </p>
      <textarea id="script" name="script" style="color: #000;"></textarea>
      <p> Tool:
        <input type="text" id="tool" name="tool"/>
      </p>
      <p> Requires:
        <input type="text" id="requires" name="tool"/>
      </p>
      <p> Provides:
        <input type="text" id="provides" name="tool"/>
      </p>
      <p align="center">
        <button type="button" value="enter" onClick="editAction()">Done</button>
      </p>
      <p align="center">
        <button type="button" value="enter" onClick="removeAction()">Remove Action</button>
      </p>
      <p align="center">
        <button type="button" value="enter" onClick="cutAction()">Cut Action</button>
      </p>
      <p align="center">
        <button type="button" value="enter" onClick="cancel()">Cancel</button>
      </p>
      </table>
    </form>
    <form id="flowEditor" style="width: 300px;background-image:url('static/images/dark_wall.png'); color:#fff;">
      <table>
        <p>Name: <Input type="text" name="flowName" id="flowName"/></p>
        <p> Type:
          <select id="flowType" style="color:#000;" name="flowType">
            <option value="branch">Branch</option>
            <option value="iteration">Iteration</option>
            <option value="selection">Selection</option>
            <option value="sequence">Sequence</option>
          </select>
        </p>
	<br>
        <p align="center">
          <button type="button" value="enter" onClick="editSequence()">Done</button>
        </p>
        <p align="center">
          <button type="button" value="enter" onClick="removeSequence()">Remove</button>
        </p>
        <p align="center">
          <button type="button" value="enter" onClick="cutSequence()">Cut</button>
        </p>
        <p align="center">
          <button type="button" value="enter" onClick="cancel()">Cancel</button>
        </p>
        </table>
      </form>
  </body>
  <textarea id="outputPanel" disabled="disabled">Output</textarea>
  <script type="text/javascript">
    function changeActionColour(newValue) {
        actionColour = newValue;
    }
    {% if data %}
      $(window).load(function(){
        var data = {{ data | safe }};
        drawJSON(data);
      });
    {% endif %}
    window.onbeforeunload = function()
    {
        return "Any progress you made on the diagram will be lost.";
    };

	function toggle_flowlines() {
		if ( drawingSwimLanes == true ) {
			drawingSwimLanes = false;
		}
		else {
			drawingSwimLanes = true;
		}
	}

    function toggle_editing() {
        if(state == StateEnum.notEditing) {
            state = StateEnum.normal;
        }
        else {
            state = StateEnum.notEditing;
        }
    }

    function parse_hook() {
      createPML();
    }

    function new_hook() {
      console.log("new pressed");
      selectedIndex = [];
      clipBoard = [];
      program = {name: "new_process", actions: new Array()};
      canvasResize(windowWidth, windowHeight - 50);
      middle = height / 2;
      update();
      $.ajax("/resetCurrent");
    }

	function save_hook(){
      console.log("save pressed");
      pushTemp(function(response) {
        window.location.href = 'save'
      });
    }

    function saveAs_hook(){
      console.log("save as pressed");
      pushTemp(function(response) {
        window.location.href = 'saveAs'
      });
    }
    function open_hook() {
      console.log("open pressed");
      // document.title ="blah";
      window.location.href = 'openFile';
    }
    function upload_hook() {
      console.log("open pressed");
      window.location.href = 'openFile';
    }

    function run_hook() {
        var pml = json_to_pml(program);

        $.ajax({
            url: '/',
            data: { program: pml },
            type: 'POST',
            success: function(response) {
                document.getElementById("outputPanel").innerHTML = response;
                console.log(response);
            },
            error: function(error) {
                alert(error.responseText);
                document.getElementById("outputPanel").innerHTML = response;
                highlight_error(error.responseText);
            }
        });

        $("#outputPanel").show();
    }
    </script>
</html>
